const IEEE802154_FRAME_TYPE_ACK = 2;

pub fn main(api) {
    // CVE check
    // Hook handling of incoming frames after initial sanity checks in ieee802154_recv
    api.on_basic_block(Some(symbolizer::resolve("ieee802154_recv")? + 0x42), |_| on_CVE_2021_3320());
}

fn on_CVE_2021_3320() {
    // Check for unexpected frame type
    if register::read("R3")? == IEEE802154_FRAME_TYPE_ACK {
        input::add_bug("CVE-2021-3320");
    }
}