// PORTING: Hook sub instruction before memcpy in gnrs_sixlowpan_iphc_receive
const HOOKED_ADDR = 0x20fc70;

pub fn main(api) {
    // before memcpy in _iphc_encode
    api.on_instruction(Some(HOOKED_ADDR), on_CVE);
}

fn on_CVE(pc) {
    // PORTING: Ensure variable register assignment
    let sixlo_size = register::read("R2")?;
    let payload_offset = register::read("R4")?;
    if (payload_offset > sixlo_size) {
        // subtraction causes integer underflow
        input::add_bug("new-Bug-CVE-2023-24820");
    }
}

