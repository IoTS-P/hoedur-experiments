// Porting: Hook memcpy in gnrc_sixlowpan_iphc_recv
const HOOKED_ADDR = 0x20fc4e;

pub fn main(api) {
    api.on_instruction(Some(HOOKED_ADDR), on_CVE);
}

fn on_CVE(pc) {
    // Porting: Assure register assignment
    let ipv6 = register::read("R6")?;
    let ipv6_size = memory::read_u32(ipv6+8)?;
    let uncomp_header_len = register::read("R5")?;
    let copy_size = register::read("R2")?;

    if uncomp_header_len + copy_size > ipv6_size {
        input::add_bug("new-Bug-CVE-2023-24819");
    }
}
