// Porting: Hook start of loop in _iphc_encode
const HOOKED_ADDR = 0x20f192;

pub fn main(api) {
    api.on_instruction(Some(HOOKED_ADDR), on_CVE);
}

fn on_CVE(pc) {
    // Porting: Assure register assignment
    let pkt = register::read("R7")?;
    let next = memory::read_u32(pkt)?;
    let next = memory::read_u32(pkt)?;
    let next_next = memory::read_u32(next)?;

    if next_next == 0 {
        // Null pointer detected
        input::add_bug("new-Bug-CVE-2023-24822");
    }
}
