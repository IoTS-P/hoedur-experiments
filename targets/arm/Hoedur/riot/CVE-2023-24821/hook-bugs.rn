// Porting: Hook instruction after subtraction from pkt size
const HOOKED_ADDR = 0x20d696;

pub fn main(api) {
    api.on_instruction(Some(HOOKED_ADDR), on_CVE);
}

fn on_CVE(pc) {
    // Porting: Assure register assignment
    let frag_size = register::read("R4")?;

    if frag_size > 0x80000000 {
        // Integer uderflow detected
        input::add_bug("new-Bug-CVE-2023-24821");
    }
}
