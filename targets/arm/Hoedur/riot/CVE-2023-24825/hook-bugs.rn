struct Pktbuf { data_nullptr }
pub fn main(api) {
    let pktbuf = Pktbuf { data_nullptr: 0 };
    api.on_basic_block(Some(symbolizer::resolve("gnrc_sixlowpan_iphc_recv")?), |_| gnrc_sixlowpan_iphc_recv(pktbuf));
    api.on_basic_block(Some(symbolizer::resolve("gnrc_pktbuf_mark")?), |_| gnrc_pktbuf_mark(pktbuf));
}

fn gnrc_pktbuf_mark(pktbuf) {
    let pkt = register::read("R0")?;
    let pkt_size = memory::read_u32(pkt+8)?;
    let mark_size = register::read("R1")?;
    if pkt_size == mark_size {
        pktbuf.data_nullptr = 1;
    }
}

fn gnrc_sixlowpan_iphc_recv(pktbuf) {
    let sixlo = register::read("R0")?;
    let data = memory::read_u32(sixlo+4)?;

    // check NULL pointer deref on sixlo->data
    if data == 0 && pktbuf.data_nullptr == 1 {
        input::add_bug("new-Bug-CVE-2023-24825");
    }
}
