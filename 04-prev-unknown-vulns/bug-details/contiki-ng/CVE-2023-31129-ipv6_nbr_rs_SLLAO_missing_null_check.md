# Missing NULL Pointer Check in IPv6 Neighbor Discovery

## Summary
A missing NULL pointer check in the IPv6 parsing of the SLLAO Neighbor Discovery option leads to a crash of the IPv6 stack.

Proposed Security Advisory Text:
```
# Impact

While processing IPv6 ICMP packets, the IPv6 of Contiki performs Neighbor Discovery. Router Solicitation (RS) messages are used to locate routers and update their address information via the SLLAO (Source Link-Layer Address Option). If indicated source address changes, a given neighbor entry is set to the STALE state.

However, the Contiki-NG Neighbor Discovery logic (os/net/ipv6/uip-nd6.c) does not check for RS messages with an SLLAO that indicates a link-layer address change that a neighbor entry can actually be created for the indicated address. The resulting pointer is used without a check, leading to the de-reference of a NULL pointer of type uip_ds6_nbr_t.
```

## Description

The missing NULL pointer check is located in the `rs_input` function:
- https://github.com/contiki-ng/contiki-ng/blob/332b54feab0af595d95e947c9f625a95e5a270de/os/net/ipv6/uip-nd6.c#L683

The check is not performed on the output of the `uip_ds6_nbr_add` function.

As opposed to this use, the return value from this function is checked in various other locations:
- https://github.com/contiki-ng/contiki-ng/blob/332b54feab0af595d95e947c9f625a95e5a270de/os/net/ipv6/uip-nd6.c#L1052
- https://github.com/contiki-ng/contiki-ng/blob/332b54feab0af595d95e947c9f625a95e5a270de/os/net/ipv6/uip-nd6.c#L1078
- https://github.com/contiki-ng/contiki-ng/blob/332b54feab0af595d95e947c9f625a95e5a270de/os/net/ipv6/tcpip.c#L601

## Impact

Crafted IPv6 packets may crash the IPv6 network stack resulting in Denial of Service (DoS).

## Proposed Fix
To fix this issue, we can insert a NULL pointer check after the specified use:

```
diff --git a/os/net/ipv6/uip-nd6.c b/os/net/ipv6/uip-nd6.c
index ebda83036..75298f3b0 100644
--- a/os/net/ipv6/uip-nd6.c
+++ b/os/net/ipv6/uip-nd6.c
@@ -682,6 +682,9 @@ rs_input(void)
           uip_ds6_nbr_rm(nbr);
           nbr = uip_ds6_nbr_add(&UIP_IP_BUF->srcipaddr, &lladdr_aligned,
                                 0, NBR_STALE, NBR_TABLE_REASON_IPV6_ND, NULL);
+          if(nbr == NULL) {
+            goto discard;
+          }
           nbr->reachable = nbr_data.reachable;
           nbr->sendns = nbr_data.sendns;
           nbr->nscount = nbr_data.nscount;
-- 
```